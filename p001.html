<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">

		<script type="text/javascript">
			var i, j, k;
var ns=3, nd=4, nc=2, nh=0, x=ns-1;
var n_s=3, n_d=4, n_c=2, n_h=0;
var ra, rb, rc, rd;
var a;
var aa;
var b = [[0,1],[0,x],[1,0],[x,0],[1,1],[x,x],[x,1],[1,x]];
var c = ['rgb(0,0,0)','rgb(0,255,255)','rgb(255,0,255)','rgb(255,255,0)','rgb(0,0,255)','rgb(0,255,0)','rgb(255,0,0)','rgb(255,255,255)']
var c_aux;
var c_grand = 600/ns;
var c_petit = 600/(3*ns);
var l_dizaine = 600/(5*ns);
var l_unite = 600/(7*ns);
var b_dizaine = (c_petit - l_dizaine) / 2;
var b_unite = (c_petit - l_unite) / 2;
function modi(c, d){
	for(i=0; i<nd; i++){
		for(j=0; j<nd; j++){
			if( (parseInt(i/2) != parseInt(j/2)) || i==j ){
				a[ (c+b[i][0])%ns ][ (d+b[i][1])%ns ][j]   =   (   a[ (c+b[i][0])%ns ][ (d+b[i][1])%ns ][j]   +   a[c][d][i]   ) % nc;
			}
		}
	}
	return 'succes'
}
function init(){
	var i, j, k
	ns=parseInt(n_s); nd=parseInt(n_d); nc=parseInt(n_c); nh=parseInt(n_h);
	x=ns-1;
	c_grand = 600/ns;
	c_petit = 600/(3*ns);
	l_dizaine = 600/(5*ns);
	l_unite = 600/(7*ns);
	b_dizaine = (c_petit - l_dizaine) / 2;
	b_unite = (c_petit - l_unite) / 2;
	a=[];
	aa=[];
	b = [[0,1],[0,x],[1,0],[x,0],[1,1],[x,x],[x,1],[1,x]];
	for(i=0; i<ns; i++){
		a.push([]);
		for(j=0; j<ns; j++){
			a[i].push([]);
			for(k=0; k<nd; k++){
				a[i][j].push(1);
			}
		}
	}
	//console.log("rand"+i+" "+ra+" "+rb);
	rc=-1; rd=-1
	for(i=0; i<nh; i++){
		ra = Math.floor(Math.random()*ns)
		rb = Math.floor(Math.random()*ns)
		if(ra!=rc || rb!=rd){
			modi(ra, rb);
			rc=ra; rd=rb
		}else{
			i--
		}
		//console.log("rand"+i+" "+ra+" "+rb);
	}
	for(i=0; i<ns; i++){
		aa.push([]);
		for(j=0; j<ns; j++){
			aa[i].push([]);
			for(k=0; k<nd; k++){
				aa[i][j].push(a[i][j][k]);
			}
		}
	}
}
function rein(){
	var i, j, k
	// re init
	for(i=0; i<ns; i++){
		for(j=0; j<ns; j++){
			for(k=0; k<nd; k++){
				a[i][j][k] = aa[i][j][k]
			}
		}
	}
}
function affi(){
	var plat_canva = document.getElementById("plateau");
	if (plat_canva.getContext) {
		var ctx = plat_canva.getContext("2d");
		ctx.fillStyle = 'rgb(0,0,0)';
		ctx.fillRect(0,0,600,600);
		ctx.fillStyle = 'rgb(255,255,255)';

		for(i=1; i<ns; i++){
			ctx.fillRect(i*c_grand-6/ns, 0, 12/ns+1, 600);
		}
		for(i=1; i<ns; i++){
			ctx.fillRect(0, i*c_grand-6/ns, 600, 12/ns+1);
		}

		for(i=0; i<ns; i++){
			for(j=0; j<ns; j++){
				for(k=0; k<nd; k++){
					c_aux = a[i][j][k]
					ctx.fillStyle = c[c_aux]
					ctx.fillRect(c_grand*i + (1+b[k][0])%ns*c_petit + b_unite, c_grand*j + (1+b[k][1])%ns*c_petit + b_unite, l_unite, l_unite);
				}
			}
		}
	}
}
		</script>

	</head>






	<body>

		<div id="menu">
			<input type="button" value="new" onclick="init(); affi();"/>
			<input type="button" value="restart" onclick="rein(); affi();"/><br/>
			Random:    <input id="nnh" type="number" min="0" max="1000" value="0" oninput="n_h=nnh.value"/><br/>
			Colors:    <input id="nnc" type="number" min="2" max="8"    value="2" oninput="n_c=nnc.value"/><br/>
			Size:      <input id="nns" type="number" min="3" max="12"   value="3" oninput="n_s=nns.value"/><br/>
			Directions:<input id="nnd" type="number" min="2" max="8"    value="4" oninput="n_d=nnd.value"/><br/>
		</div>

		<canvas id="plateau" width="600" height="600" onclick="modi(parseInt(event.clientX/(600/ns)),parseInt(event.clientY/(600/ns))); affi();">
		</canvas>


		<style type="text/css">
body {background-color: black; color: white}
#plateau { border: 1px solid blue; }
#menu { position: absolute; top: 10px; left: 630px;}
		</style>

	<script>
		init(); affi();
			//<-onclick="modi(parseInt(e.pageX/c_grand), parseInt(e.pageY/c_grand)); affi();"->
	</script>

	</body>
</html>

